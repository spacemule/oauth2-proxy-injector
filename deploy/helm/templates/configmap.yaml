{{- if .Values.defaultProxyConfig.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.config.defaultConfigMap }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "oauth2-proxy-injector.labels" . | nindent 4 }}
    app.kubernetes.io/component: oauth2-proxy-config
data:
  # ===== Provider Settings =====
  provider: {{ .Values.defaultProxyConfig.provider | quote }}
  {{- with .Values.defaultProxyConfig.oidcIssuerUrl }}
  oidc-issuer-url: {{ . | quote }}
  {{- end }}
  {{- with .Values.defaultProxyConfig.oidcGroupsClaim }}
  oidc-groups-claim: {{ . | quote }}
  {{- end }}
  {{- with .Values.defaultProxyConfig.scope }}
  scope: {{ . | quote }}
  {{- end }}

  # ===== Identity Settings =====
  {{- with .Values.defaultProxyConfig.clientId }}
  client-id: {{ . | quote }}
  {{- end }}
  {{- with .Values.defaultProxyConfig.clientSecretRef }}
  client-secret-ref: {{ . | quote }}
  {{- end }}
  {{- if .Values.defaultProxyConfig.pkceEnabled }}
  pkce-enabled: "true"
  {{- end }}

  # ===== Cookie Settings =====
  {{- with .Values.defaultProxyConfig.cookieSecretRef }}
  cookie-secret-ref: {{ . | quote }}
  {{- end }}
  {{- with .Values.defaultProxyConfig.cookieDomains }}
  cookie-domains: {{ . | quote }}
  {{- end }}
  {{- with .Values.defaultProxyConfig.cookieName }}
  cookie-name: {{ . | quote }}
  {{- end }}
  cookie-secure: {{ .Values.defaultProxyConfig.cookieSecure | quote }}

  # ===== Authorization Settings =====
  {{- with .Values.defaultProxyConfig.emailDomains }}
  email-domains: {{ . | quote }}
  {{- end }}
  {{- with .Values.defaultProxyConfig.allowedGroups }}
  allowed-groups: {{ . | quote }}
  {{- end }}
  {{- with .Values.defaultProxyConfig.whitelistDomains }}
  whitelist-domains: {{ . | quote }}
  {{- end }}

  # ===== Routing Settings =====
  {{- with .Values.defaultProxyConfig.redirectUrl }}
  redirect-url: {{ . | quote }}
  {{- end }}
  {{- with .Values.defaultProxyConfig.extraJwtIssuers }}
  extra-jwt-issuers: {{ . | quote }}
  {{- end }}

  # ===== Header/Token Passing Settings =====
  {{- if .Values.defaultProxyConfig.passAccessToken }}
  pass-access-token: "true"
  {{- end }}
  {{- if .Values.defaultProxyConfig.setXAuthRequest }}
  set-xauthrequest: "true"
  {{- end }}
  {{- if .Values.defaultProxyConfig.passAuthorizationHeader }}
  pass-authorization-header: "true"
  {{- end }}

  # ===== Behavior Settings =====
  {{- if .Values.defaultProxyConfig.skipProviderButton }}
  skip-provider-button: "true"
  {{- end }}

  # ===== Container Settings =====
  proxy-image: {{ .Values.defaultProxyConfig.proxyImage | quote }}
  {{- with .Values.defaultProxyConfig.extraArgs }}
  extra-args: |
    {{- . | nindent 4 }}
  {{- end }}
{{- end }}
